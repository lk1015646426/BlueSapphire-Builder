<Window x:Class="BlueSapphire.Builder.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:BlueSapphire.Builder.ViewModels"
        mc:Ignorable="d"
        Title="Blue Sapphire Cyber" Height="850" Width="1100"
        WindowStartupLocation="CenterScreen" Background="{StaticResource BackgroundBrush}">

    <WindowChrome.WindowChrome>
        <WindowChrome GlassFrameThickness="1" CornerRadius="0" CaptionHeight="40"/>
    </WindowChrome.WindowChrome>

    <d:Window.DataContext>
        <vm:MainViewModel/>
    </d:Window.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="40"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Background="#020408">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Border Grid.ColumnSpan="3" VerticalAlignment="Bottom" Height="1" Background="#1E293B"/>

            <StackPanel Orientation="Horizontal" Margin="15,0,0,0" VerticalAlignment="Center">
                <Viewbox Width="16" Height="16" Margin="0,0,10,0">
                    <Path Data="{StaticResource Icon_Diamond}" Fill="{StaticResource NeonBlueBrush}">
                        <Path.Effect>
                            <DropShadowEffect Color="#00F0FF" BlurRadius="6" ShadowDepth="0"/>
                        </Path.Effect>
                    </Path>
                </Viewbox>
                <TextBlock Text="BLUE SAPPHIRE" FontSize="14" FontWeight="Bold" Foreground="#FFF" VerticalAlignment="Center"/>
                <TextBlock Text=" // CYBER BUILDER" FontSize="12" Foreground="{StaticResource NeonBlueBrush}" VerticalAlignment="Center" Margin="5,0,0,0" Opacity="0.8"/>
            </StackPanel>

            <StackPanel Grid.Column="2" Orientation="Horizontal">
                <Button Style="{StaticResource WindowButtonStyle}" Click="BtnMin_Click">
                    <Path Data="{StaticResource Icon_Minimize}" Width="10" Height="10" Fill="{StaticResource TextBrush}" Stretch="Uniform"/>
                </Button>
                <Button Style="{StaticResource CloseButtonStyle}" Click="BtnClose_Click">
                    <Path Data="{StaticResource Icon_Close}" Width="10" Height="10" Fill="{StaticResource TextBrush}" Stretch="Uniform"/>
                </Button>
            </StackPanel>
        </Grid>

        <Grid Grid.Row="1" Margin="25,20,25,25">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="25"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>

            <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Hidden" PanningMode="VerticalOnly">
                <StackPanel>

                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                                <Viewbox Width="18" Height="18" Margin="0,0,10,0">
                                    <Path Data="{StaticResource Icon_Info}" Fill="{StaticResource NeonBlueBrush}"/>
                                </Viewbox>
                                <TextBlock Text="核心元数据 [CORE DATA]" Style="{StaticResource SectionHeader}"/>
                            </StackPanel>

                            <Grid Margin="0,0,0,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*"/>
                                    <ColumnDefinition Width="20"/>
                                    <ColumnDefinition Width="1*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="程序代号 (Name)" Style="{StaticResource LabelText}"/>
                                    <TextBox Text="{Binding AppName}" Tag="输入项目名称..."/>
                                </StackPanel>

                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="编译版本 (Ver)" Style="{StaticResource LabelText}"/>
                                    <TextBox Text="{Binding Version}" TextAlignment="Center" Foreground="{StaticResource NeonBlueBrush}" FontWeight="Bold"/>
                                </StackPanel>
                            </Grid>

                            <StackPanel Margin="0,0,0,20">
                                <TextBlock Text="发布组织 / 公司 (Publisher)" Style="{StaticResource LabelText}"/>
                                <TextBox Text="{Binding Publisher}"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="应用唯一识别码 (AppID)" Style="{StaticResource LabelText}"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="10"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Text="{Binding AppID}" FontFamily="Consolas" IsReadOnly="True" Background="#050A14" Foreground="#64748B"/>
                                    <Button Grid.Column="2" Content="生成标识" Click="BtnGenID_Click" 
                                            Style="{StaticResource OutlineButton}" Padding="15,0" Height="36"/>
                                </Grid>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                                <Viewbox Width="18" Height="18" Margin="0,0,10,0">
                                    <Path Data="{StaticResource Icon_Folder}" Fill="{StaticResource NeonBlueBrush}"/>
                                </Viewbox>
                                <TextBlock Text="环境配置节点 [ENV CONFIG]" Style="{StaticResource SectionHeader}"/>
                            </StackPanel>

                            <StackPanel Margin="0,0,0,20">
                                <TextBlock Text="源项目文件 (.csproj)" Style="{StaticResource LabelText}"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="8"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Text="{Binding ProjectPath}" IsReadOnly="True" Foreground="#64748B"/>
                                    <Button Grid.Column="2" Content="浏览..." Click="BtnBrowseProject_Click" 
                                            Style="{StaticResource OutlineButton}" Padding="15,0" Height="36"/>
                                </Grid>
                            </StackPanel>

                            <StackPanel Margin="0,0,0,20">
                                <TextBlock Text="Inno Setup 编译器 (ISCC.exe)" Style="{StaticResource LabelText}"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="8"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Text="{Binding InnoSetupPath}"/>
                                    <Button Grid.Column="2" Content="浏览..." Click="BtnBrowseInno_Click" 
                                            Style="{StaticResource OutlineButton}" Padding="15,0" Height="36"/>
                                </Grid>
                            </StackPanel>

                            <StackPanel Margin="0,0,0,20">
                                <TextBlock Text="安装脚本模板 (.iss) [可选]" Style="{StaticResource LabelText}"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="8"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Text="{Binding IssScriptPath}" ToolTip="留空则自动检测" Tag="默认使用项目根目录 installer.iss"/>
                                    <Button Grid.Column="2" Content="浏览..." Click="BtnBrowseIss_Click" 
                                            Style="{StaticResource OutlineButton}" Padding="15,0" Height="36"/>
                                </Grid>
                            </StackPanel>

                            <Rectangle Height="1" Fill="#1E293B" Margin="0,5,0,20"/>

                            <StackPanel Margin="0,0,0,15">
                                <TextBlock Text="[A] 编译产物输出 (Raw Output)" Style="{StaticResource LabelText}" Foreground="{StaticResource NeonBlueBrush}"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="8"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Text="{Binding RawOutputDir}" IsReadOnly="True"/>
                                    <Button Grid.Column="2" Content="选择目录" Click="BtnBrowseRaw_Click" 
                                            Style="{StaticResource OutlineButton}" Padding="15,0" Height="36"/>
                                </Grid>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="[B] 最终安装包 (Installer)" Style="{StaticResource LabelText}" Foreground="{StaticResource NeonPurpleBrush}"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="8"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Text="{Binding SetupOutputDir}" IsReadOnly="True"/>
                                    <Button Grid.Column="2" Content="选择目录" Click="BtnBrowseSetup_Click" 
                                            Style="{StaticResource OutlineButton}" Padding="15,0" Height="36"/>
                                </Grid>
                            </StackPanel>

                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>

            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Style="{StaticResource CardStyle}" BorderBrush="{StaticResource NeonBlueBrush}" BorderThickness="1">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                            <Viewbox Width="20" Height="20" Margin="0,0,10,0">
                                <Path Data="{StaticResource Icon_Rocket}" Fill="{StaticResource NeonBlueBrush}"/>
                            </Viewbox>
                            <TextBlock Text="编译链路控制 [PIPELINE]" Style="{StaticResource SectionHeader}"/>
                        </StackPanel>

                        <CheckBox IsChecked="{Binding MakeInstaller}" Content="生成安装程序 (Inno Setup)" 
                                  Margin="0,0,0,25" FontWeight="Bold" Foreground="#FFF"/>

                        <Button x:Name="BtnBuild" Content="🚀  启动构建序列" 
                                Height="55" Click="BtnBuild_Click"
                                Style="{StaticResource HeroButton}"
                                IsEnabled="{Binding IsNotBuilding}"/>

                        <Grid Margin="0,25,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <ProgressBar Height="4" Value="{Binding ProgressValue}" Maximum="100" 
                                         BorderThickness="0" Background="#1E293B" Foreground="{StaticResource NeonBlueBrush}">
                                <ProgressBar.Effect>
                                    <DropShadowEffect Color="#00F0FF" BlurRadius="5" ShadowDepth="0"/>
                                </ProgressBar.Effect>
                            </ProgressBar>

                            <Grid Grid.Row="1" Margin="0,10,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="{Binding ProgressText}" FontSize="12" FontFamily="Consolas" Foreground="{StaticResource NeonBlueBrush}"/>
                                <TextBlock Grid.Column="1" Text="{Binding ProgressValue, StringFormat={}{0}%}" FontSize="12" Foreground="{StaticResource TechGreyBrush}"/>
                            </Grid>
                        </Grid>
                    </StackPanel>
                </Border>

                <Border Grid.Row="1" Background="#000" BorderBrush="#1E293B" BorderThickness="1" CornerRadius="4" Padding="0" Margin="0,0,0,16" ClipToBounds="True">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="34"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Border Background="#0F172A" BorderBrush="#1E293B" BorderThickness="0,0,0,1">
                            <Grid Margin="10,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <Viewbox Width="12" Height="12" Margin="0,0,8,0">
                                        <Path Data="{StaticResource Icon_Console}" Fill="{StaticResource TechGreyBrush}"/>
                                    </Viewbox>
                                    <TextBlock Text="系统日志流 // SYSTEM LOG" Foreground="{StaticResource TechGreyBrush}" FontSize="11" FontFamily="Consolas" FontWeight="Bold"/>
                                </StackPanel>

                                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                    <Button Style="{StaticResource ConsoleToolButtonStyle}" Click="BtnCopyLog_Click" ToolTip="复制日志">
                                        <Viewbox Width="12" Height="12">
                                            <Path Data="{StaticResource Icon_Copy}" Fill="{StaticResource TechGreyBrush}"/>
                                        </Viewbox>
                                    </Button>
                                    <Button Style="{StaticResource ConsoleToolButtonStyle}" Click="BtnClearLog_Click" ToolTip="清空终端">
                                        <Viewbox Width="12" Height="12">
                                            <Path Data="{StaticResource Icon_Trash}" Fill="{StaticResource TechGreyBrush}"/>
                                        </Viewbox>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <TextBox x:Name="TxtLog" Grid.Row="1" Margin="8"
                                 Style="{StaticResource ConsoleStyle}"
                                 Foreground="#00FF41"
                                 VerticalScrollBarVisibility="Auto"/>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</Window>